version: '3.8'

services:
  signal-api:
    image: bbernhard/signal-cli-rest-api:latest
    container_name: fitness-coach-signal-api
    environment:
      - MODE=json-rpc
      #- SIGNAL_CLI_UID=1000 # Optional: Match your user ID
      #- SIGNAL_CLI_GID=1000 # Optional: Match your group ID
    volumes:
      - ./secrets/signal-data:/home/.local/share/signal-cli
    ports:
      - '8080:8080'
    restart: unless-stopped

  fitness-coach:
    build: .
    container_name: fitness-coach
    env_file:
      - .env
    depends_on:
      - signal-api
    volumes:
      - ./secrets:/app/secrets
      - ./fitness_journal.db:/app/fitness_journal.db
      - ./profiles.json:/app/profiles.json
      - ./.env:/app/.env
    # Run the bot daemon by default
    command: [ "--signal", "--daemon" ]
    restart: unless-stopped
